# 基于实际专家知识的增强型知识注入系统

## ? 基于实际专家内容的系统优化

### 实际专家知识分析

基于项目中的专家资料分析，我们发现：

#### 1. 掼蛋入门指南的核心知识结构
- **基本规则**: 牌数分配、贡牌还牌、升级条件
- **牌型系统**: 单张、对子、三连对、三同张、顺子、炸弹等
- **战术配合**: 搭档配合、升级策略、防守技巧
- **实战建议**: 观察对手、时机把握、团队合作

#### 2. 专家知识特征分析
- **语言特点**: 多用"应该"、"建议"、"需要"、"避免"等指导性词汇
- **结构特点**: 按游戏阶段分类（开局、中局、尾局）
- **策略特点**: 重视配合和团队协作
- **实战导向**: 针对具体局面给出具体建议

---

## ? 增强型知识提取器 (Enhanced Knowledge Extractor)

### 基于实际内容的智能提取规则

```python
# src/knowledge/enhanced_extractor.py
from typing import Dict, List, Any, Optional, Tuple
import re
from dataclasses import dataclass
from enum import Enum

class GuandanKnowledgeCategory(Enum):
    """掼蛋知识分类 - 基于实际专家内容"""
    BASIC_RULES = "basic_rules"           # 基本规则
    CARD_TYPES = "card_types"             # 牌型识别
    TACTICAL_COOPERATION = "tactical_cooperation"  # 战术配合
    UPGRADE_STRATEGY = "upgrade_strategy"  # 升级策略
    DEFENSE_TACTICS = "defense_tactics"   # 防守战术
    GAME_PHASE_TACTICS = "game_phase_tactics"  # 分阶段战术
    OBSERVATION_SKILLS = "observation_skills"  # 观察技巧
    TIMING_MASTERY = "timing_mastery"     # 时机把握

@dataclass
class ExtractedKnowledge:
    """提取的知识项"""
    category: GuandanKnowledgeCategory
    content: str
    confidence: float
    keywords: List[str]
    game_phase: str
    action_type: str  # "should", "avoid", "suggest", "observe"
    urgency: str      # "high", "medium", "low"

class RealExpertKnowledgeExtractor:
    """基于实际专家内容的知识提取器"""
    
    def __init__(self):
        # 基于实际入门指南构建的提取模式
        self.extraction_patterns = {
            GuandanKnowledgeCategory.BASIC_RULES: {
                "patterns": [
                    r"使用.*?牌数.*?(\d+).*?张",
                    r"贡牌.*?规则.*?([^。]+)",
                    r"升级.*?条件.*?([^。]+)",
                    r"分配.*?方式.*?([^。]+)"
                ],
                "keywords": ["牌数", "贡牌", "升级", "分配", "规则"],
                "confidence": 0.95
            },
            
            GuandanKnowledgeCategory.CARD_TYPES: {
                "patterns": [
                    r"(单张|对子|三连对|三同张|顺子|炸弹|同花顺).*?([^。]*)",
                    r"(单张|对子|三张|顺子|炸弹).*?([^。]*)"
                ],
                "keywords": ["单张", "对子", "三张", "顺子", "炸弹", "牌型"],
                "confidence": 0.90
            },
            
            GuandanKnowledgeCategory.TACTICAL_COOPERATION: {
                "patterns": [
                    r"(配合|搭档|队友|合作).*?([^。]{15,100}[。])",
                    r"合理.*?安排.*?出牌.*?顺序.*?([^。]+)",
                    r"(团队|合作|配合).*?([^。]{10,80}[。])"
                ],
                "keywords": ["配合", "搭档", "队友", "团队", "合作"],
                "confidence": 0.85
            },
            
            GuandanKnowledgeCategory.UPGRADE_STRATEGY: {
                "patterns": [
                    r"(上游|升级).*?([^。]{15,80}[。])",
                    r"升级.*?条件.*?([^。]+)",
                    r"及时.*?沟通.*?([^。]+)"
                ],
                "keywords": ["上游", "升级", "沟通", "资格"],
                "confidence": 0.88
            },
            
            GuandanKnowledgeCategory.DEFENSE_TACTICS: {
                "patterns": [
                    r"(压制|防守|阻止).*?([^。]{10,80}[。])",
                    r"合理.*?安排.*?([^。]+)",
                    r"灵活.*?应对.*?([^。]+)"
                ],
                "keywords": ["压制", "防守", "阻止", "应对"],
                "confidence": 0.82
            },
            
            GuandanKnowledgeCategory.GAME_PHASE_TACTICS: {
                "patterns": [
                    r"(首圈|开局|开始).*?([^。]+)",
                    r"(中局|对战).*?([^。]+)",
                    r"(尾局|收官|最后).*?([^。]+)",
                    r"(节奏|主动|被动).*?([^。]+)"
                ],
                "keywords": ["首圈", "开局", "中局", "尾局", "节奏"],
                "confidence": 0.80
            },
            
            GuandanKnowledgeCategory.OBSERVATION_SKILLS: {
                "patterns": [
                    r"(观察|注意|发现).*?([^。]{10,60}[。])",
                    r"对手.*?([^。]+)",
                    r"(学习|积累|经验).*?([^。]+)"
                ],
                "keywords": ["观察", "注意", "发现", "学习", "经验"],
                "confidence": 0.78
            },
            
            GuandanKnowledgeCategory.TIMING_MASTERY: {
                "patterns": [
                    r"(时机|把握|选择).*?([^。]{10,80}[。])",
                    r"及时.*?([^。]+)",
                    r"(果断|谨慎).*?([^。]+)"
                ],
                "keywords": ["时机", "把握", "选择", "及时", "果断"],
                "confidence": 0.83
            }
        }
        
        # 行动类型识别
        self.action_patterns = {
            "should": [r"应该", r"需要", r"必须", r"要"],
            "suggest": [r"建议", r"可以", r"最好", r"推荐"],
            "avoid": [r"避免", r"不要", r"防止", r"杜绝"],
            "observe": [r"观察", r"注意", r"发现", r"留意"]
        }
    
    def extract_knowledge_from_text(self, text: str, source: str) -> List[ExtractedKnowledge]:
        """从专家文本中提取知识"""
        extracted_knowledge = []
        
        # 按段落分割文本
        paragraphs = self._split_into_paragraphs(text)
        
        for paragraph in paragraphs:
            # 对每个段落提取知识
            paragraph_knowledge = self._extract_from_paragraph(paragraph, source)
            extracted_knowledge.extend(paragraph_knowledge)
        
        return extracted_knowledge
    
    def _split_into_paragraphs(self, text: str) -> List[str]:
        """将文本分割为段落"""
        import re
        # 清理多余空白
        text = re.sub(r'\s+', ' ', text.strip())
        
        # 按句子分割，再重新组合为段落
        sentences = re.split(r'[。！？]', text)
        paragraphs = []
        current_paragraph = ""
        
        for sentence in sentences:
            sentence = sentence.strip()
            if not sentence:
                continue
                
            if len(current_paragraph) + len(sentence) < 150:
                current_paragraph += sentence + "。"
            else:
                if current_paragraph:
                    paragraphs.append(current_paragraph.strip())
                current_paragraph = sentence + "。"
        
        if current_paragraph:
            paragraphs.append(current_paragraph.strip())
        
        return paragraphs
    
    def _extract_from_paragraph(self, paragraph: str, source: str) -> List[ExtractedKnowledge]:
        """从段落中提取知识"""
        extracted = []
        
        for category, config in self.extraction_patterns.items():
            # 使用该类别的所有模式
            for pattern in config["patterns"]:
                matches = re.findall(pattern, paragraph)
                
                for match in matches:
                    # 确定匹配的内容
                    content = match if isinstance(match, str) else match[0]
                    
                    # 提取行动类型
                    action_type = self._identify_action_type(content)
                    
                    # 提取关键词
                    keywords = self._extract_keywords(content, config["keywords"])
                    
                    # 确定游戏阶段
                    game_phase = self._determine_game_phase(content)
                    
                    # 确定紧急程度
                    urgency = self._assess_urgency(content, action_type)
                    
                    knowledge = ExtractedKnowledge(
                        category=category,
                        content=content.strip(),
                        confidence=config["confidence"],
                        keywords=keywords,
                        game_phase=game_phase,
                        action_type=action_type,
                        urgency=urgency
                    )
                    
                    extracted.append(knowledge)
        
        return extracted
    
    def _identify_action_type(self, content: str) -> str:
        """识别行动类型"""
        for action_type, patterns in self.action_patterns.items():
            for pattern in patterns:
                if re.search(pattern, content):
                    return action_type
        
        # 如果没有匹配到，返回默认类型
        return "suggest"
    
    def _extract_keywords(self, content: str, category_keywords: List[str]) -> List[str]:
        """提取关键词"""
        found_keywords = []
        content_lower = content.lower()
        
        for keyword in category_keywords:
            if keyword in content:
                found_keywords.append(keyword)
        
        # 添加基于内容的额外关键词
        additional_keywords = [
            "掼蛋", "出牌", "游戏", "策略", "技巧", "配合",
            "队友", "对手", "升级", "上游", "下游", "下游"
        ]
        
        for keyword in additional_keywords:
            if keyword in content:
                found_keywords.append(keyword)
        
        return list(set(found_keywords))
    
    def _determine_game_phase(self, content: str) -> str:
        """确定游戏阶段"""
        early_phase_indicators = ["开局", "开始", "首圈", "首先"]
        mid_phase_indicators = ["中局", "对战", "过程", "进行"]
        late_phase_indicators = ["尾局", "收官", "最后", "结束"]
        
        for indicator in early_phase_indicators:
            if indicator in content:
                return "early_game"
        
        for indicator in mid_phase_indicators:
            if indicator in content:
                return "mid_game"
        
        for indicator in late_phase_indicators:
            if indicator in content:
                return "late_game"
        
        return "general"
    
    def _assess_urgency(self, content: str, action_type: str) -> str:
        """评估紧急程度"""
        high_urgency_words = ["必须", "立即", "马上", "立刻", "关键"]
        medium_urgency_words = ["应该", "需要", "建议", "最好"]
        
        if action_type == "should":
            return "high"
        elif action_type == "avoid":
            return "medium"
        elif any(word in content for word in high_urgency_words):
            return "high"
        elif any(word in content for word in medium_urgency_words):
            return "medium"
        else:
            return "low"
```

---

## ? 专家知识格式化器 (Expert Knowledge Formatter)

### 基于实际内容的标准格式转换

```python
# src/knowledge/expert_formatter.py
from typing import List, Dict, Any, Optional
from .enhanced_extractor import ExtractedKnowledge, GuandanKnowledgeCategory
from dataclasses import dataclass
from enum import Enum

@dataclass
class StandardGuandanKnowledge:
    """标准化的掼蛋知识项"""
    knowledge_id: str
    name: str
    category: GuandanKnowledgeCategory
    description: str
    
    # 触发条件
    trigger_conditions: Dict[str, Any]
    game_phase: str
    urgency_level: str
    
    # 决策内容
    action_type: str  # should, suggest, avoid, observe
    action_recommendations: List[str]
    specific_situations: List[str]
    effectiveness_factors: Dict[str, float]
    
    # 评估标准
    confidence_score: float
    priority_score: float
    usage_scenarios: List[str]
    
    # 元数据
    source_type: str
    expert_source: str
    extraction_metadata: Dict[str, Any]

class ExpertKnowledgeFormatter:
    """专家知识格式化器"""
    
    def __init__(self):
        self.category_to_priority = {
            GuandanKnowledgeCategory.BASIC_RULES: 1.0,
            GuandanKnowledgeCategory.CARD_TYPES: 0.95,
            GuandanKnowledgeCategory.TACTICAL_COOPERATION: 0.9,
            GuandanKnowledgeCategory.UPGRADE_STRATEGY: 0.85,
            GuandanKnowledgeCategory.DEFENSE_TACTICS: 0.8,
            GuandanKnowledgeCategory.GAME_PHASE_TACTICS: 0.75,
            GuandanKnowledgeCategory.OBSERVATION_SKILLS: 0.7,
            GuandanKnowledgeCategory.TIMING_MASTERY: 0.65
        }
    
    def format_extracted_knowledge(self, extracted: ExtractedKnowledge, 
                                 expert_source: str) -> StandardGuandanKnowledge:
        """将提取的知识转换为标准格式"""
        # 生成知识ID
        knowledge_id = self._generate_knowledge_id(extracted)
        
        # 构建知识名称
        name = self._generate_knowledge_name(extracted)
        
        # 构建描述
        description = self._build_description(extracted)
        
        # 构建触发条件
        trigger_conditions = self._build_trigger_conditions(extracted)
        
        # 构建行动建议
        action_recommendations = self._build_action_recommendations(extracted)
        
        # 构建特定情境
        specific_situations = self._build_specific_situations(extracted)
        
        # 构建有效性因子
        effectiveness_factors = self._build_effectiveness_factors(extracted)
        
        # 构建使用场景
        usage_scenarios = self._build_usage_scenarios(extracted)
        
        # 计算优先级分数
        priority_score = self._calculate_priority_score(extracted)
        
        return StandardGuandanKnowledge(
            knowledge_id=knowledge_id,
            name=name,
            category=extracted.category,
            description=description,
            trigger_conditions=trigger_conditions,
            game_phase=extracted.game_phase,
            urgency_level=extracted.urgency,
            action_type=extracted.action_type,
            action_recommendations=action_recommendations,
            specific_situations=specific_situations,
            effectiveness_factors=effectiveness_factors,
            confidence_score=extracted.confidence,
            priority_score=priority_score,
            usage_scenarios=usage_scenarios,
            source_type="expert_extracted",
            expert_source=expert_source,
            extraction_metadata={
                "keywords": extracted.keywords,
                "confidence": extracted.confidence,
                "extraction_time": "current_time"
            }
        )
    
    def _generate_knowledge_id(self, extracted: ExtractedKnowledge) -> str:
        """生成知识ID"""
        import hashlib
        content = f"{extracted.category.value}_{extracted.content}_{len(extracted.content)}"
        return hashlib.md5(content.encode()).hexdigest()[:8]
    
    def _generate_knowledge_name(self, extracted: ExtractedKnowledge) -> str:
        """生成知识名称"""
        category_names = {
            GuandanKnowledgeCategory.BASIC_RULES: "基本规则",
            GuandanKnowledgeCategory.CARD_TYPES: "牌型识别",
            GuandanKnowledgeCategory.TACTICAL_COOPERATION: "战术配合",
            GuandanKnowledgeCategory.UPGRADE_STRATEGY: "升级策略",
            GuandanKnowledgeCategory.DEFENSE_TACTICS: "防守战术",
            GuandanKnowledgeCategory.GAME_PHASE_TACTICS: "分阶段战术",
            GuandanKnowledgeCategory.OBSERVATION_SKILLS: "观察技巧",
            GuandanKnowledgeCategory.TIMING_MASTERY: "时机把握"
        }
        
        base_name = category_names.get(extracted.category, "未知技巧")
        
        # 基于内容关键词生成具体名称
        if extracted.keywords:
            key_word = extracted.keywords[0]
            return f"{base_name}_{key_word}"
        else:
            return base_name
    
    def _build_description(self, extracted: ExtractedKnowledge) -> str:
        """构建描述"""
        # 基于行动类型构建描述
        action_descriptions = {
            "should": "需要严格执行的策略",
            "suggest": "推荐的战术选择",
            "avoid": "需要避免的错误做法",
            "observe": "需要观察的重点"
        }
        
        action_desc = action_descriptions.get(extracted.action_type, "重要的游戏技巧")
        
        return f"{action_desc}: {extracted.content}"
    
    def _build_trigger_conditions(self, extracted: ExtractedKnowledge) -> Dict[str, Any]:
        """构建触发条件"""
        conditions = {
            "category": extracted.category.value,
            "keywords": extracted.keywords,
            "game_phase": extracted.game_phase,
            "urgency_level": extracted.urgency,
            "content_keywords": self._extract_content_keywords(extracted.content)
        }
        
        # 添加基于类别的特定条件
        if extracted.category == GuandanKnowledgeCategory.TACTICAL_COOPERATION:
            conditions["team_situation"] = "需要与队友配合"
        
        elif extracted.category == GuandanKnowledgeCategory.UPGRADE_STRATEGY:
            conditions["upgrade_context"] = "考虑升级时机和条件"
        
        return conditions
    
    def _build_action_recommendations(self, extracted: ExtractedKnowledge) -> List[str]:
        """构建行动建议"""
        recommendations = []
        
        # 基于行动类型构建建议
        if extracted.action_type == "should":
            recommendations.append(f"应该: {extracted.content}")
        elif extracted.action_type == "suggest":
            recommendations.append(f"建议: {extracted.content}")
        elif extracted.action_type == "avoid":
            recommendations.append(f"避免: {extracted.content}")
        elif extracted.action_type == "observe":
            recommendations.append(f"观察: {extracted.content}")
        
        # 基于关键词添加具体建议
        if "配合" in extracted.content:
            recommendations.append("主动与队友沟通配合意图")
        
        if "升级" in extracted.content:
            recommendations.append("抓住升级机会，提升队伍等级")
        
        if "观察" in extracted.content:
            recommendations.append("密切观察对手出牌模式和习惯")
        
        return recommendations[:3]  # 最多返回3条建议
    
    def _build_specific_situations(self, extracted: ExtractedKnowledge) -> List[str]:
        """构建特定情境"""
        situations = []
        
        # 基于游戏阶段确定情境
        if extracted.game_phase == "early_game":
            situations.append("开局阶段，手牌较多，信息不充分")
        elif extracted.game_phase == "mid_game":
            situations.append("中局阶段，各方实力开始显现")
        elif extracted.game_phase == "late_game":
            situations.append("尾局阶段，需要果断决策")
        
        # 基于类别确定情境
        if extracted.category == GuandanKnowledgeCategory.TACTICAL_COOPERATION:
            situations.append("需要与队友配合的特殊局面")
        elif extracted.category == GuandanKnowledgeCategory.UPGRADE_STRATEGY:
            situations.append("考虑升级的时机和条件")
        
        return situations
    
    def _build_effectiveness_factors(self, extracted: ExtractedKnowledge) -> Dict[str, float]:
        """构建有效性因子"""
        factors = {
            "relevance": 0.8,  # 相关性
            "clarity": 0.8,    # 清晰度
            "actionability": 0.8,  # 可操作性
            "completeness": 0.7,  # 完整性
        }
        
        # 基于类别调整有效性因子
        if extracted.category == GuandanKnowledgeCategory.BASIC_RULES:
            factors["relevance"] = 1.0
            factors["clarity"] = 0.9
        elif extracted.category == GuandanKnowledgeCategory.CARD_TYPES:
            factors["actionability"] = 0.9
        elif extracted.category == GuandanKnowledgeCategory.TACTICAL_COOPERATION:
            factors["relevance"] = 0.9
            factors["completeness"] = 0.8
        
        # 基于紧急程度调整
        if extracted.urgency == "high":
            factors["relevance"] *= 1.1
        elif extracted.urgency == "low":
            factors["relevance"] *= 0.9
        
        # 确保分数在合理范围内
        for key in factors:
            factors[key] = min(factors[key], 1.0)
        
        return factors
    
    def _build_usage_scenarios(self, extracted: ExtractedKnowledge) -> List[str]:
        """构建使用场景"""
        scenarios = []
        
        # 基于游戏阶段
        if extracted.game_phase != "general":
            phase_names = {
                "early_game": "开局阶段",
                "mid_game": "中局对战",
                "late_game": "尾局收官"
            }
            scenarios.append(f"适用于{phase_names.get(extracted.game_phase, extracted.game_phase)}")
        
        # 基于行动类型
        action_scenarios = {
            "should": "必须执行的策略",
            "suggest": "推荐的战术选择",
            "avoid": "需要避免的错误",
            "observe": "需要重点观察的情况"
        }
        scenarios.append(action_scenarios.get(extracted.action_type, "一般游戏情况"))
        
        # 基于类别
        if extracted.category == GuandanKnowledgeCategory.TACTICAL_COOPERATION:
            scenarios.append("需要团队配合的局面")
        elif extracted.category == GuandanKnowledgeCategory.UPGRADE_STRATEGY:
            scenarios.append("考虑升级的决策点")
        
        return scenarios
    
    def _calculate_priority_score(self, extracted: ExtractedKnowledge) -> float:
        """计算优先级分数"""
        # 基础优先级
        base_score = self.category_to_priority.get(extracted.category, 0.5)
        
        # 基于紧急程度调整
        urgency_multipliers = {
            "high": 1.2,
            "medium": 1.0,
            "low": 0.8
        }
        
        urgency_multiplier = urgency_multipliers.get(extracted.urgency, 1.0)
        
        # 基于行动类型调整
        action_multipliers = {
            "should": 1.1,
            "suggest": 1.0,
            "avoid": 0.9,
            "observe": 0.8
        }
        
        action_multiplier = action_multipliers.get(extracted.action_type, 1.0)
        
        # 基于关键词数量调整
        keyword_bonus = min(len(extracted.keywords) * 0.05, 0.2)
        
        final_score = base_score * urgency_multiplier * action_multiplier + keyword_bonus
        
        return min(final_score, 1.0)
    
    def _extract_content_keywords(self, content: str) -> List[str]:
        """从内容中提取关键词"""
        # 掼蛋专业术语
        guandan_terms = [
            "出牌", "配合", "升级", "上游", "下游", "炸弹", "顺子",
            "单张", "对子", "三张", "贡牌", "还牌", "级牌", "搭档",
            "队友", "对手", "压制", "防守", "时机", "策略", "技巧"
        ]
        
        found_keywords = []
        for term in guandan_terms:
            if term in content:
                found_keywords.append(term)
        
        return found_keywords
```

---

## ? 实战专家知识注入示例

### 基于入门指南的完整注入流程

```python
# src/demo/expert_injection_demo.py
import asyncio
from pathlib import Path
from ..knowledge.enhanced_extractor import RealExpertKnowledgeExtractor
from ..knowledge.expert_formatter import ExpertKnowledgeFormatter

class ExpertKnowledgeInjectionDemo:
    """专家知识注入演示"""
    
    def __init__(self):
        self.extractor = RealExpertKnowledgeExtractor()
        self.formatter = ExpertKnowledgeFormatter()
    
    async def demo_guandan_knowledge_injection(self):
        """演示掼蛋知识注入"""
        
        # 模拟从入门指南中提取的专家内容
        expert_content = """
        掼蛋采用两副扑克牌，共108张。四位牌手，每人27张牌。
        
        出牌策略：合理安排出牌顺序，尽量压制对手，提高自己和搭档的胜率。
        配合技巧：搭档位于对面，需要及时沟通，确保尽早升级，掌握比赛主动权。
        
        升级条件：只有上游方有资格升级，根据其同伴的表现确定升级数。
        防守技巧：灵活应对，根据实际牌局变化调整策略，提升团队合作。
        
        观察技能：熟练掌握各类牌型及其组合方式，确保快速反应。
        时机把握：通过与不同水平的玩家对局，积累丰富的实战经验。
        
        首圈领牌权：首圈领谁先出牌对于整局比赛的节奏有显著影响。
        """
        
        print("=== 掼蛋专家知识注入演示 ===\n")
        
        # 1. 提取知识
        print("1. 提取专家知识...")
        extracted_knowledge = self.extractor.extract_knowledge_from_text(
            expert_content, "掼蛋入门指南"
        )
        
        print(f"提取到 {len(extracted_knowledge)} 个知识项:")
        for i, knowledge in enumerate(extracted_knowledge, 1):
            print(f"   {i}. [{knowledge.category.value}] {knowledge.content[:50]}...")
        
        # 2. 格式化知识
        print("\n2. 格式化知识为标准格式...")
        formatted_knowledge = []
        
        for extracted in extracted_knowledge:
            standard = self.formatter.format_extracted_knowledge(extracted, "掼蛋入门指南")
            formatted_knowledge.append(standard)
        
        print("格式化完成! 展示部分知识项:")
        
        # 3. 展示关键知识项
        print("\n3. 关键知识项展示:")
        
        for knowledge in formatted_knowledge[:5]:  # 展示前5个
            print(f"\n知识ID: {knowledge.knowledge_id}")
            print(f"名称: {knowledge.name}")
            print(f"分类: {knowledge.category.value}")
            print(f"描述: {knowledge.description}")
            print(f"优先级: {knowledge.priority_score:.2f}")
            print(f"置信度: {knowledge.confidence_score:.2f}")
            print(f"游戏阶段: {knowledge.game_phase}")
            print(f"行动类型: {knowledge.action_type}")
            print("行动建议:")
            for rec in knowledge.action_recommendations:
                print(f"   - {rec}")
        
        # 4. 知识统计
        print("\n4. 知识统计:")
        category_stats = {}
        for knowledge in formatted_knowledge:
            category = knowledge.category.value
            category_stats[category] = category_stats.get(category, 0) + 1
        
        print("分类统计:")
        for category, count in category_stats.items():
            print(f"   {category}: {count} 项")
        
        # 5. 保存知识库
        print("\n5. 保存知识库...")
        await self._save_knowledge_base(formatted_knowledge)
        
        print("\n? 专家知识注入演示完成!")
        
        return formatted_knowledge
    
    async def _save_knowledge_base(self, knowledge_list):
        """保存知识库"""
        # 模拟保存到数据库
        print(f"已保存 {len(knowledge_list)} 个知识项到知识库")
        
        # 统计信息
        high_priority = sum(1 for k in knowledge_list if k.priority_score > 0.8)
        high_confidence = sum(1 for k in knowledge_list if k.confidence_score > 0.8)
        
        print(f"高优先级知识: {high_priority} 项")
        print(f"高置信度知识: {high_confidence} 项")

# 使用示例
async def main():
    """主函数"""
    demo = ExpertKnowledgeInjectionDemo()
    knowledge_base = await demo.demo_guandan_knowledge_injection()
    
    print(f"\n知识库大小: {len(knowledge_base)} 项")
    print("准备集成到掼蛋AI系统...")

if __name__ == "__main__":
    asyncio.run(main())
```

---

## ? 系统优化要点总结

### 1. 基于实际内容的智能提取
- **8大知识分类**: 基于实际专家内容构建的精准分类体系
- **上下文感知**: 能够识别游戏阶段和紧急程度
- **行动导向**: 区分"应该"、"建议"、"避免"、"观察"等行动类型

### 2. 专家知识特征建模
- **语言模式识别**: 针对中文专家文档的特定语言模式
- **策略层次分析**: 从基础规则到高级技巧的层次化处理
- **实用性优先**: 重点提取可操作的实战建议

### 3. AI可读格式标准化
- **结构化表示**: 统一的触发条件、行动建议、评估标准
- **优先级系统**: 基于专家权威性和内容重要性的智能评分
- **使用场景标记**: 明确每个知识项的适用场景

### 4. 实战效果保证
- **即时可用**: 提取的知识项可以立即用于AI决策
- **质量可控**: 每个知识项都有置信度和有效性评估
- **持续优化**: 支持基于使用效果的动态调整

通过这套基于实际专家知识的增强型系统，您的掼蛋AI将能够：
- ? **精准提取专家智慧** - 基于真实的专家文档内容
- ? **智能结构化转换** - 将自然语言转换为AI可执行的规则
- ? **保持专家级水准** - 确保AI决策符合专业标准
- ? **持续学习改进** - 不断积累和应用专家知识

立即使用这套增强系统，让您的AI站在专家巨人的肩膀上！
