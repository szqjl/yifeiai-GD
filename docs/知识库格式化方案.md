# 掼蛋AI知识库格式化方案

## 📋 方案概述

本文档提出掼蛋AI知识库的格式化标准，旨在将**江苏掼蛋规则**、**掼蛋入门指南**、**掼蛋技巧秘籍**三个文档统一格式化，便于AI系统理解、检索和应用。

**与架构方案对齐**：
- ✅ 本方案与《掼蛋AI客户端架构方案.md》第3.4节"知识库模块"完全对齐
- ✅ 知识分类体系对应架构方案的分层记忆策略（硬编码层、内存加载层、按需查询层）
- ✅ 目录结构对应架构方案的`docs/knowledge/`目录设计
- ✅ 变量命名统一使用平台标准变量名（Single/Pair/Bomb等）
- ✅ 知识检索方式对应架构方案的`KnowledgeRetriever`接口设计

**目标**：
- 统一知识表示格式
- 便于AI检索和理解
- 支持知识分层和关联
- 便于知识更新和维护
- 与架构方案的知识库模块设计保持一致

---

## 🎯 知识分类体系

### 一级分类（知识域）- 对齐架构方案

**与架构方案的知识库模块设计对齐**：

```
1. 规则知识 (Rules) - 对应架构方案的"规则库 (Rules Library)"
   - **说明**：规则知识是最高准则，整合了江苏掼蛋规则.md、掼蛋入门指南.txt等多个源文档的内容，消除了重复和交叉
   - 基础规则（硬编码层）- 对应 `01_basic_rules/` 目录
     - 牌型定义、牌张分配、游戏流程、升级规则
     - 游戏介绍、基本概念、快速入门（整合自basics目录）
     - 基础策略、练习建议（整合自basics目录）
   - 比赛规则（硬编码层）- 对应 `02_competition_rules/` 目录（包含违规处理）
   - 进贡报牌规则（硬编码层）- 对应 `03_advanced_rules/` 目录（进贡规则、报牌规则）
   - 实现方式：硬编码到GameRules类中

3. 策略知识 (Strategy) - 对应架构方案的"策略库 (Strategy Library)"
   - 主攻策略（内存加载层）
   - 助攻策略（内存加载层）
   - 通用策略（内存加载层）
   - 组牌技巧和优先级（内存加载层）
   - 配火原则（内存加载层）
   - 实现方式：启动时加载到内存

4. 技巧知识 (Skills) - 对应架构方案的"技巧库 (Skills Library)"
   - 基础技巧（按需查询层）- 对应 `01_foundation/` 目录
   - 主攻技巧（按需查询层）- 对应 `02_main_attack/` 目录
   - 助攻技巧（按需查询层）- 对应 `03_assist_attack/` 目录
   - 通用技巧（按需查询层）- 对应 `04_common_skills/` 目录（包含配牌技巧、出牌技巧、记牌技巧等）
   - 心理知识（按需查询层）- 对应 `05_psychology/` 目录（心态调整、风格分析、配合默契）
   - 高级技巧（按需查询层）- 对应 `06_advanced/` 目录
   - 开局技巧（按需查询层）- 对应 `07_opening/` 目录 ⭐ 新增
   - 残局技巧（按需查询层）- 对应 `08_endgame/` 目录 ⭐ 新增
   - 实现方式：按需查询知识库文件，结果缓存
```

**分层记忆策略对应关系**（基于架构方案3.4.1节）：

| 知识分类 | 架构方案层级 | 实现方式 | 访问方式 | 更新方式 |
|---------|------------|---------|---------|---------|
| 规则知识 (Rules) | 硬编码层 | 直接写在代码中 | O(1)直接调用 | 代码修改 |
| 策略知识 (Strategy) | 内存加载层 | 程序启动时加载到内存 | O(1)内存访问 | 重启程序或热更新 |
| 技巧知识 (Skills) | 按需查询层 | 需要时查询知识库文件，结果缓存 | 首次O(n)查询，后续O(1)缓存访问 | 知识库文件更新，缓存失效 |

---

## 📐 格式化标准

### 0. 变量命名统一标准（基于南京邮电大学平台）

#### 0.1 牌型变量命名（平台标准）

**必须使用平台标准变量名**，所有知识库文档中的牌型引用统一使用以下变量：

| 平台变量名 | 中文名称 | 说明 |
|-----------|---------|------|
| `Single` | 单张 | 任意一张牌 |
| `Pair` | 对子 | 两张牌点相同的牌 |
| `Trips` | 三张 | 三张牌点相同的牌 |
| `ThreePair` | 三连对 | 三个牌点相邻的对子 |
| `ThreeWithTwo` | 三带二 | 一个三同张和一个对子 |
| `TwoTrips` | 钢板 | 两个牌点相邻的三同张 |
| `Straight` | 顺子 | 五张牌点相邻的单张 |
| `StraightFlush` | 同花顺 | 花色相同的顺子（特殊顺子）⭐ 更新 |
| `Bomb` | 炸弹 | 四张(含)以上牌点相同的单张 |
| `tribute` | 进贡 | 进贡阶段使用的牌型 ⭐ 新增 |
| `back` | 还贡 | 还贡阶段使用的牌型 ⭐ 新增 |
| `PASS` | 过 | 不出牌 ⭐ 新增 |

#### 0.2 花色变量命名（平台标准）

| 平台变量名 | 中文名称 | 说明 |
|-----------|---------|------|
| `S` | 黑桃 | Spades |
| `H` | 红桃 | Hearts（逢人配）⭐ 更新：平台文档为"红桃" |
| `D` | 方片 | Diamonds ⭐ 更新：平台文档为"方片" |
| `C` | 梅花 | Clubs |
| `R` | 大王 | Red Joker（大王的花色为H，点数为R）⭐ 更新 |
| `B` | 小王 | Black Joker（小王的花色为S，点数为B）⭐ 更新 |

**重要说明**：
- 平台文档：黑桃、红桃、梅花、方片分别对应字符S、H、C、D
- 特别地，小王的花色为S，点数为B（表示为'SB'）
- 特别地，大王的花色为H，点数为R（表示为'HR'）

#### 0.3 点数变量命名（平台标准）

| 平台变量名 | 中文名称 | 说明 |
|-----------|---------|------|
| `A` | A | Ace |
| `2` | 2 | 主牌起点 |
| `3-9` | 3-9 | 数字牌 |
| `T` | 10 | Ten |
| `J` | J | Jack |
| `Q` | Q | Queen |
| `K` | K | King |

#### 0.4 游戏状态变量命名（平台标准）

| 平台变量名 | 中文名称 | 说明 |
|-----------|---------|------|
| `myPos` | 我的座位号 | 0-3，0和2一队，1和3一队 ⭐ 更新 |
| `curPos` | 当前玩家座位号 | 当前出牌的玩家座位号（0-3）⭐ 更新 |
| `handCards` | 手牌 | 当前手牌列表（JSON字段名）⭐ 更新 |
| `curRank` | 当前等级 | 当前级牌（2-A）⭐ 新增 |
| `selfRank` | 我方等级 | 我方当前等级 ⭐ 新增 |
| `oppoRank` | 对方等级 | 对方当前等级 ⭐ 新增 |
| `stage` | 游戏阶段 | beginning/play/tribute/back/episodeOver/gameOver等 ⭐ 更新 |
| `type` | 消息类型 | notify/act ⭐ 新增 |

**注意**：
- 平台使用0-3作为座位号，不是1-4
- 第0个和第2个连接的AI自动为一队
- 第1个和第3个连接的AI自动为一队

#### 0.5 变量命名使用规范

1. **在代码示例中**：必须使用平台标准变量名
   ```python
   # ✅ 正确
   card_type = "Bomb"
   suit = "H"  # 红心
   rank = "A"
   
   # ❌ 错误
   card_type = "炸弹"
   suit = "红心"
   ```

2. **在知识描述中**：中文名称 + 平台变量名（括号）
   ```markdown
   - **单张 (Single)**：任意一张牌
   - **对子 (Pair)**：两张牌点相同的牌
   - **炸弹 (Bomb)**：四张(含)以上牌点相同的单张
   ```

3. **在JSON示例中**：严格按照平台格式
   ```json
   // 牌型格式：[牌型, 点数, 卡牌列表]
   ["Bomb", "2", ["H2", "D2", "C2", "S2"]]
   
   // 游戏开始消息
   {
     "type": "notify",
     "stage": "beginning",
     "handCards": ["S2", "H2", "C2", "D2", ...],
     "myPos": 0
   }
   
   // 出牌动作消息
   {
     "type": "act",
     "stage": "play",
     "handCards": ["S2", "H2", ...],
     "curPos": 0,
     "curAction": ["Single", "2", ["S2"]],
     "actionList": [["PASS", "PASS", "PASS"], ["Single", "2", ["S2"]]]
   }
   ```

4. **在关联知识中**：统一使用平台变量名
   ```markdown
   ## 相关牌型
   - [Single - 单张]
   - [Pair - 对子]
   - [Bomb - 炸弹]
   ```

#### 0.6 变量映射表（用于文档转换）

| 文档中的中文术语 | 平台标准变量名 | 使用场景 |
|----------------|--------------|---------|
| 单张 | `Single` | 所有代码和JSON |
| 对子 | `Pair` | 所有代码和JSON |
| 三同张/三头 | `Trips` | 所有代码和JSON |
| 三连对 | `ThreePair` | 所有代码和JSON |
| 三带二/三带对 | `ThreeWithTwo` | 所有代码和JSON |
| 钢板 | `TwoTrips` | 所有代码和JSON |
| 顺子 | `Straight` | 所有代码和JSON |
| 同花顺 | `StraightFlush` | 所有代码和JSON ⭐ 更新 |
| 炸弹 | `Bomb` | 所有代码和JSON |
| 进贡 | `tribute` | 所有代码和JSON ⭐ 新增 |
| 还贡 | `back` | 所有代码和JSON ⭐ 新增 |
| 过 | `PASS` | 所有代码和JSON ⭐ 新增 |
| 黑桃 | `S` | 所有代码和JSON |
| 红心 | `H` | 所有代码和JSON |
| 方块 | `D` | 所有代码和JSON |
| 梅花 | `C` | 所有代码和JSON |
| 大王 | `R` | 所有代码和JSON |
| 小王 | `B` | 所有代码和JSON |
| 主牌 | `main_rank` | 游戏状态变量 |
| 级牌 | `main_rank` | 游戏状态变量 |
| 逢人配 | `H` + `main_rank` | 红心级牌 |

#### 0.7 变量命名规范总结

**核心原则**：
1. **所有代码和JSON必须使用平台变量名**
2. **所有文档中首次出现术语时，标注平台变量名**
3. **建立中文术语到平台变量名的映射表**

**格式化要求**：
- ✅ 正确：`单张 (Single)`、`对子 (Pair)`、`炸弹 (Bomb)`
- ✅ 正确：代码中使用 `card_type = "Bomb"`
- ✅ 正确：JSON中使用 `"type": "Bomb"`
- ❌ 错误：只写中文"单张"、"对子"、"炸弹"
- ❌ 错误：代码中使用 `card_type = "炸弹"`

**实施步骤**：
1. 格式化时，将所有牌型术语替换为"中文 (平台变量名)"格式
2. 所有代码示例必须使用平台变量名
3. 所有JSON示例必须符合平台格式
4. 建立术语映射表，确保一致性

---

### 1. 文档结构标准

#### 1.1 元数据区（文档头部）

```markdown
---
title: 文档标题
category: 知识分类（一级/二级）
source: 来源文档
version: 版本号
last_updated: 最后更新时间（使用系统时间API：datetime.now()）
tags: [标签1, 标签2, ...]
difficulty: 难度等级（入门/初级/中级/高级/专家）
priority: 优先级（1-5，5最高）
game_phase: 游戏阶段（opening/midgame/endgame，可选）⭐ 新增
---
```

**注意**：
- `last_updated` 字段必须使用系统时间API获取，禁止硬编码时间。
  - Python: `datetime.now().strftime('%Y-%m-%d %H:%M:%S')`
  - JavaScript: `new Date().toLocaleString('zh-CN')`
- `game_phase` 字段用于标注知识点适用的游戏阶段：⭐ 新增
  - `opening`: 开局阶段（起手、首攻、初期策略）
  - `midgame`: 中局阶段（常规斗牌过程）
  - `endgame`: 残局阶段（手数减少、听牌、冲刺）

#### 1.2 内容结构

```markdown
# 标题（H1）

## 概述
简要说明知识点

## 详细内容
具体内容...

## 应用场景
何时使用此知识

## 相关知识点
- [链接到相关知识点]

## 示例/案例
实际应用示例

## 注意事项
重要提醒
```

---

### 2. 知识点格式化模板

#### 2.1 规则类知识点

```markdown
---
title: 知识点标题
type: rule
category: Rules/Basic
tags: [规则, 牌型, 出牌]
difficulty: 入门
priority: 5
---

# 知识点标题

## 规则定义
**官方定义**：引用官方规则原文

**简化说明**：用通俗语言解释

## 适用条件
- 条件1
- 条件2

## 规则细节
1. 细节1
2. 细节2

## 违规处理
违规情况及其处理方式

## 相关规则
- [相关规则链接]
```

#### 2.2 策略类知识点

```markdown
---
title: 知识点标题
type: strategy
category: Strategy/MainAttack
tags: [主攻, 出牌, 时机]
difficulty: 中级
priority: 4
---

# 知识点标题

## 策略概述
策略的核心思想

## 适用场景
- 场景1：描述
- 场景2：描述

## 执行步骤
1. 步骤1
2. 步骤2

## 关键要点
- 要点1
- 要点2

## 实战案例
**案例描述**：具体牌局情况

**执行过程**：如何应用策略

**结果分析**：策略效果

## 注意事项
- 注意1
- 注意2

## 相关策略
- [相关策略链接]
```

#### 2.3 技巧类知识点

```markdown
---
title: 知识点标题
type: skill
category: Skills/配牌
tags: [配牌, 炸弹, 优化]
difficulty: 高级
priority: 5
game_phase: midgame  # 可选：opening/midgame/endgame ⭐ 新增
---

# 知识点标题

## 技巧说明
技巧的核心内容

## 适用阶段 ⭐ 新增
- **开局阶段**：描述在开局阶段的应用
- **中局阶段**：描述在中局阶段的应用
- **残局阶段**：描述在残局阶段的应用
（根据技巧特点，可能只适用于特定阶段）

## 应用条件
何时使用此技巧

## 操作步骤
1. 步骤1
2. 步骤2

## 技巧要点
- 要点1（重要性说明）
- 要点2（重要性说明）

## 实战示例
**牌型示例**：具体牌型

**操作过程**：详细操作

**效果分析**：技巧效果

## 常见错误
- 错误1：说明
- 错误2：说明

## 进阶技巧
- [相关进阶技巧]
```

---

### 3. 知识关联标准

#### 3.1 知识层级关系

```
规则知识（基础层）
    ↓
基础知识（理解层）
    ↓
策略知识（应用层）
    ↓
技巧知识（优化层）
    ↓
心理知识（提升层）
```

#### 3.2 知识关联标记

```markdown
## 前置知识
- [必须掌握的知识点]

## 后续知识
- [基于此知识点的进阶内容]

## 相关知识点
- [横向关联的知识点]

## 对立/替代知识
- [相反或替代的策略]
```

---

## 📚 源文档格式化指南

**重要说明**：以下不是三个选择方案，而是三个源文档如何格式化到统一知识库结构的指南。所有源文档都会按照统一的目录结构格式化到 `docs/knowledge/` 目录中。

**源文档映射关系**：
- **江苏掼蛋规则.md + 掼蛋入门指南.txt（整合修订）** → 格式化到 `rules/` 目录（规则知识，最高准则）
- **掼蛋技巧秘籍(丁华).md** → 格式化到 `skills/` 目录（技巧知识）

**重要说明**：
- `rules/` 目录是规则知识的最高准则，整合了江苏掼蛋规则.md、掼蛋入门指南.txt等多个源文档的内容，消除了重复和交叉
- 原 `basics/` 目录中的内容已整合到 `rules/01_basic_rules/` 目录中，不再单独存在

**统一的知识库目录结构**（所有源文档都按此结构格式化）：
```
docs/knowledge/
├── rules/              # 规则知识（最高准则，整合自：江苏掼蛋规则.md + 掼蛋入门指南.txt）
│   ├── 01_basic_rules/      # 基础规则（包含原basics目录的内容）
│   ├── 02_competition_rules/ # 比赛规则
│   └── 03_advanced_rules/    # 进贡报牌规则
└── skills/             # 技巧知识（来自：掼蛋技巧秘籍(丁华).md）
```

---

### 源文档一：江苏掼蛋规则.md

#### 格式化目标
- 提取核心规则点
- 结构化规则内容
- 标注规则优先级

#### 格式化结构（对齐架构方案）

**注意**：规则知识对应架构方案的"规则库 (Rules Library)"，实现方式为硬编码层。

```
docs/knowledge/
├── rules/              # 规则知识（硬编码层）- 对应架构方案3.4.2节
│   ├── 01_basic_rules/
│   │   ├── 01_card_types.md          # 牌型定义
│   │   ├── 02_card_distribution.md    # 牌张分配
│   │   ├── 03_game_flow.md            # 游戏流程
│   │   └── 04_upgrade_rules.md        # 升级规则
│   ├── 02_competition_rules/
│   │   ├── 01_competition_format.md   # 竞赛形式
│   │   ├── 02_scoring.md              # 计分规则
│   │   └── 03_violation_handling.md    # 违规处理
│   └── 03_advanced_rules/             # 进贡报牌规则（目录名保持与架构方案一致）
│       ├── 01_tribute_rules.md        # 进贡规则
│       └── 02_reporting_rules.md     # 报牌规则
├── rules/              # 规则知识（硬编码层）- 对应架构方案3.4.2节
│   ├── 01_basic_rules/      # 基础规则（整合了原basics目录的内容）
│   │   ├── 01_card_types.md          # 牌型定义
│   │   ├── 01_card_types_guide.md    # 牌型指南（整合自basics）
│   │   ├── 02_card_distribution.md    # 牌张分配
│   │   ├── 03_game_flow.md            # 游戏流程
│   │   ├── 04_upgrade_rules.md        # 升级规则
│   │   ├── 05_game_introduction.md    # 游戏介绍（整合自basics）
│   │   ├── 06_basic_concepts.md       # 基本概念（整合自basics）
│   │   ├── 07_quick_start.md          # 快速入门（整合自basics）
│   │   ├── 08_basic_strategy.md       # 基础策略（整合自basics）
│   │   └── 09_practice_tips.md        # 练习建议（整合自basics）
└── skills/              # 技巧知识（按需查询层）- 对应架构方案3.4.4节
    ├── 01_foundation/        # 基础技巧
    ├── 02_main_attack/       # 主攻技巧
    ├── 03_assist_attack/     # 助攻技巧
    ├── 04_common_skills/     # 通用技巧（配牌、出牌、记牌等）
    ├── 05_psychology/        # 心理知识（心态、风格、配合）
    ├── 06_advanced/          # 高级技巧
    ├── 07_opening/          # 开局技巧（组牌技巧等）
    └── 08_endgame/          # 残局技巧
```

**说明**：
- `rules/` 对应架构方案的"规则库"，实现为硬编码层（整合了江苏掼蛋规则.md、掼蛋入门指南.txt等多个源文档，是规则知识的最高准则）
- 原 `basics/` 目录已整合到 `rules/01_basic_rules/` 目录中，不再单独存在
- `skills/` 对应架构方案的"技巧库"，实现为按需查询层
- 策略知识（Strategy）对应架构方案的"策略库"，实现为内存加载层，通常不存储在文件系统中，而是程序启动时从配置或代码中加载

#### 格式化示例

**原内容**（江苏掼蛋规则.md 第186-196行）：
```markdown
(七)牌型
1.单张:任意一张牌。
2.对子:两张牌点相同的牌，包括两张大王和两张小王。
...
```

**格式化后**（`docs/knowledge/rules/01_basic_rules/01_card_types.md`）：
```markdown
---
title: 掼蛋牌型定义
type: rule
category: Rules/Basic
source: 江苏掼蛋规则.md
platform: 南京邮电大学平台
tags: [规则, 牌型, 基础]
difficulty: 入门
priority: 5
---

# 掼蛋牌型定义

## 概述
掼蛋游戏中的合法牌型及其定义，是游戏的基础规则。

## 牌型列表（平台标准变量）

### 1. 单张 (Single)
- **平台变量名**: `Single`
- **定义**：任意一张牌
- **优先级**：最低
- **应用场景**：所有场景
- **JSON示例**:
  ```json
  {
    "type": "Single",
    "cards": ["H2"]
  }
  ```

### 2. 对子 (Pair)
- **平台变量名**: `Pair`
- **定义**：两张牌点相同的牌，包括两张大王和两张小王
- **优先级**：低
- **应用场景**：控制单张、配合策略
- **JSON示例**:
  ```json
  {
    "type": "Pair",
    "cards": ["H2", "D2"]
  }
  ```

### 3. 三同张 (Trips)
- **平台变量名**: `Trips`
- **定义**：三张牌点相同的牌
- **优先级**：中
- **应用场景**：配合对子组成三带二

### 4. 三连对 (ThreePair)
- **平台变量名**: `ThreePair`
- **定义**：三个牌点相邻的对子
- **优先级**：中
- **应用场景**：快速出牌、减少手数

### 5. 三带二 (ThreeWithTwo)
- **平台变量名**: `ThreeWithTwo`
- **定义**：一个三同张和一个对子
- **优先级**：中
- **应用场景**：常见组牌方式

### 6. 钢板 (TwoTrips)
- **平台变量名**: `TwoTrips`
- **定义**：两个牌点相邻的三同张
- **优先级**：中高
- **应用场景**：特殊牌型，可偷袭

### 7. 顺子 (Straight)
- **平台变量名**: `Straight`
- **定义**：五张牌点相邻的单张
- **优先级**：中
- **应用场景**：连接单牌

### 8. 同花顺 (StraightFlush)
- **平台变量名**: `StraightFlush` ⭐ 修正：使用平台标准变量名
- **定义**：花色相同的顺子（特殊顺子）
- **优先级**：高
- **应用场景**：可压5张以内的炸弹

### 9. 炸弹 (Bomb)
- **平台变量名**: `Bomb`
- **定义**：四张(含)以上牌点相同的单张
- **优先级**：最高
- **应用场景**：扭转牌路、闯关

### 10. 王炸 (Bomb)
- **平台变量名**: `Bomb` (特殊)
- **定义**：大王、小王各两张
- **优先级**：最高
- **应用场景**：可压所有牌型

## 牌型大小关系
[牌型比较规则，使用平台变量名]

## 相关规则
- [出牌规则]
- [压牌规则]
```

---

### 源文档二：掼蛋入门指南.txt（已整合到rules目录）

#### 格式化目标
- **整合多个源文档**：整合掼蛋入门指南.txt、江苏掼蛋规则.md等多个源文档的内容
- **消除重复和交叉**：整合修订后形成统一的掼蛋基本规则
- 补充规则细节
- 提供入门级说明
- 简化复杂概念

#### 格式化结构（对齐架构方案）

**重要说明**：
- 原 `basics/` 目录中的文档已整合到 `rules/01_basic_rules/` 目录中
- 这些文档消除了源文档之间的重复和交叉，形成了统一的、便于理解的基本规则
- 规则知识是最高准则，所有规则相关内容统一在 `rules/` 目录中
- 对应架构方案的"规则库"，实现方式为硬编码层

**整合后的目录结构**：
```
docs/knowledge/rules/01_basic_rules/  # 基础规则（整合了原basics目录的内容）
├── 01_card_types.md                  # 牌型定义
├── 01_card_types_guide.md            # 牌型指南（整合自basics）
├── 02_card_distribution.md           # 牌张分配
├── 03_game_flow.md                   # 游戏流程
├── 04_upgrade_rules.md               # 升级规则
├── 05_game_introduction.md           # 游戏介绍（整合自basics）
├── 06_basic_concepts.md              # 基本概念（整合自basics）
├── 07_quick_start.md                 # 快速入门（整合自basics）
├── 08_basic_strategy.md              # 基础策略（整合自basics）
└── 09_practice_tips.md               # 练习建议（整合自basics）
```

#### 格式化示例

**原内容**（掼蛋入门指南.txt 第7-14行）：
```
一、基本规则 （一）牌张

使用牌数：掼蛋采用两副扑克牌，共108张。
...
```

**格式化后**（`docs/knowledge/basics/01_getting_started/02_basic_concepts.md`）：
```markdown
---
title: 掼蛋基本概念
type: basic
category: Basics/GettingStarted
source: 掼蛋入门指南.txt
tags: [入门, 概念, 基础]
difficulty: 入门
priority: 5
---

# 掼蛋基本概念

## 概述
掼蛋游戏的基本概念和术语，帮助新手快速理解游戏。

## 核心概念

### 牌张相关
- **全副牌**：108张（两副扑克牌）
- **全手牌**：每位牌手27张牌
- **一副牌**：从抓牌开始到一方打完结束
- **一手牌**：牌手一次打出的一组牌
- **一圈牌**：四位牌手依次出牌直到无人出牌

### 牌手相关
- **本家**：自己
- **对家**：对面的搭档
- **上家**：左边的对手
- **下家**：右边的对手
- **上游/二游/三游/下游**：出完牌的顺序

## 前置知识
- [游戏介绍]

## 后续知识
- [牌型定义]
- [出牌规则]
```

---

### 源文档三：掼蛋技巧秘籍(丁华).md

#### 格式化目标
- 提取71篇技巧文章
- 按主题分类组织
- 标注技巧难度和优先级
- 建立技巧关联关系

#### 格式化结构（对齐架构方案）

**注意**：技巧知识对应架构方案的"技巧库 (Skills Library)"，实现方式为按需查询层，通过KnowledgeRetriever查询。

```
docs/knowledge/skills/              # 技巧知识（按需查询层）- 对应架构方案3.4.4节
├── 01_foundation/
│   ├── 01_game_rules_essence.md      # 第2篇：规则要点
│   ├── 02_winning_methods.md         # 第3篇：头游方式
│   ├── 03_card_power_evaluation.md   # 第6篇：牌力评估
│   └── ...
├── 02_main_attack/
│   ├── 01_tail_card_principle.md    # 第13篇：尾牌原理
│   ├── 02_bomb_techniques.md         # 第16-19篇：出炸技巧
│   └── ...
├── 03_assist_attack/
│   ├── 01_pair_first.md              # 第26篇：对子先行
│   ├── 02_block_single.md            # 第28篇：卡下家
│   ├── 03_send_partner.md            # 第30篇：送对家
│   └── ...
├── 04_common_skills/
│   ├── 01_tribute_skills.md          # 第34-35篇：进贡还贡
│   ├── 02_memory_skills.md           # 第36-39篇：记牌技巧
│   ├── 03_flexibility.md            # 第51-53篇：灵活性
│   └── ...
├── 05_psychology/
│   ├── 01_mindset.md                 # 第58-60篇：心态
│   └── 02_playing_style.md           # 第61篇：打牌风格
├── 06_advanced/
│   └── 02_miscellaneous.md           # 第62-68篇：雕虫小技
├── 07_opening/                       # ⭐ 新增：开局技巧
│   ├── 01_weak_road_handling.md      # 第12篇：处理弱路
│   ├── 02_initial_play_strategy.md   # 第15篇：初期想顺牌
│   └── 03_initial_defense.md         # 第29篇：初期不炸下家
└── 08_endgame/                       # ⭐ 新增：残局技巧
    ├── 01_tail_card_in_endgame.md    # 第14篇：尾牌原理在残局中
    ├── 02_endgame_bomb_techniques.md  # 第23篇：残局逼炸为先
    └── 03_endgame_attack_defense.md   # 第55-57篇：残局攻防
```

**说明**：
- 对应架构方案3.4.4节的"技巧库 (Skills Library)"
- 通过架构方案3.4.5节的"知识检索器 (KnowledgeRetriever)"进行查询
- 支持按游戏阶段（opening/midgame/endgame）过滤
- 支持按标签（tags）匹配
- 支持按优先级（priority）排序
- 结果缓存，避免重复查询

#### 格式化示例

**原内容**（掼蛋技巧秘籍(丁华).md 第835-870行）：
```markdown
### 第16篇  出炸技巧之一:炸什么牌?

个炸价值4点，一盘牌中平均每人2.1个炸，因此炸弹是稀
有的重型武器。
...
```

**格式化后**（`docs/knowledge/skills/02_main_attack/03_bomb_techniques_01.md`）：
```markdown
---
title: 出炸技巧之一：炸什么牌
type: skill
category: Skills/MainAttack/Bomb
source: 掼蛋技巧秘籍(丁华).md
tags: [出炸, 主攻, 炸弹, 时机]
difficulty: 中级
priority: 5
part: 第16篇
---

# 出炸技巧之一：炸什么牌

## 概述
炸弹是掼蛋中稀有的重型武器，平均每人2.1个炸，每个炸价值4点。正确选择炸什么牌是出炸技巧的基础。

## 核心原则
**经济性原则**：用最小的代价获得最大的收益

## 炸牌优先级

### 1. 首打炸弹（最高优先级）
- **原因**：炸弹打炸弹最合适，4点压4点最为经济
- **适用**：80%的情况下是正确的
- **操作**：碰到敌人的炸弹闭眼打住

### 2. 打双大王
- **价值**：2点强
- **作用**：控制2手单路，也可控制对子
- **牌力**：仅次于炸弹

### 3. 打主牌三带二 (ThreeWithTwo)
- **平台变量名**: `ThreeWithTwo`
- **价值**：1点强
- **作用**：控制三带二，拆成对子可能登基，后期单主牌也有很大的登基机会
- **JSON示例**（平台格式）:
  ```json
  ["ThreeWithTwo", "2", ["H2", "D2", "C2", "H3", "D3"]]
  ```

### 4. 打其他登基牌
- **价值**：1点
- **说明**：价值1点的登基牌

### 5. 打其他牌
- **适用**：弄不准是否为登基牌，但为了避免敌方跑牌太多，可及时出炸制止
- **说明**：虽属超打，但有时很有必要

## 超打概念
**定义**：压牌时，不是用刚好大对方一级的牌，而是用相对较大的牌

**坏处**：可能造成敌方的小牌登基

**示例**：
- 你手中有大王(`R`)、A，上家出K你直接用大王压，就是超打
- 敌方7777炸弹(`Bomb`)，你用8888炸弹打最为经济，用KKKK炸弹就有点浪费了

## 应用场景
- **场景1**：敌方出炸弹 (`Bomb`) → 立即用炸弹打
- **场景2**：敌方出双大王 (`Pair` of `R`) → 用炸弹打
- **场景3**：敌方出主牌三带二 (`ThreeWithTwo` with `main_rank`) → 用炸弹打
- **场景4**：不确定是否为登基牌 → 视情况用炸弹打

## 注意事项
- 不要见大牌就炸，结果后面既无力冲刺，也无力防守
- 不要有炸舍不得用，结果最后憋死在手里
- 要经济地使用炸弹，炸点值大的牌成为首选

## 前置知识
- [炸弹的主要作用]
- [牌力评估方法]

## 后续知识
- [出炸技巧之二：炸谁的牌]
- [出炸技巧之三：出炸的时机]
- [出炸技巧之四：用哪个炸]

## 相关技巧
- [配炸技巧]
- [拆炸技巧]
- [保留实力]
```

#### 格式化示例：开局技巧

**原内容**（掼蛋技巧秘籍(丁华).md 第706-735行）：
```markdown
### 第12篇  处理弱路--两个小单张不打不健康

当你拿一手12点以上的强牌，跃跃欲试想当主攻拿头游时，手
中的各种牌路先打哪一路好呢?
如果这时你的单张是弱路，且有超过2张10以下的赘牌时，则
应首攻单张。这是为什么呢?
...
```

**格式化后**（`docs/knowledge/skills/07_opening/01_weak_road_handling.md`）：
```markdown
---
title: 处理弱路--两个小单张不打不健康
type: skill
category: Skills/Opening
source: 掼蛋技巧秘籍(丁华).md
tags: [开局, 主攻, 首攻, 弱路处理]
difficulty: 中级
priority: 5
game_phase: opening
part: 第12篇
---

# 处理弱路--两个小单张不打不健康

## 概述
当你拿一手12点以上的强牌，跃跃欲试想当主攻拿头游时，手中的各种牌路先打哪一路好呢？如果这时你的单张是弱路，且有超过2张10以下的赘牌时，则应首攻单张。

## 适用阶段
- **开局阶段**：✅ 主要适用于开局阶段的首攻选择
- **中局阶段**：⚠️ 部分适用，但效果不如开局明显
- **残局阶段**：❌ 不适用

## 核心原理
1. **后期很难冲刺获胜**：剩余两个小单张，即便是对牌力要求最低的听牌胜，也几乎没有可能。
2. **单张易被控制**：单张 (`Single`) 灵活性最差，如果遇到牌风硬朗的上家，你的小单张是无法顺出去的。
3. **可能彻底失去头游机会**：如果下家牌很整，刺留刺留出得只剩一张大单牌，进入了听牌状态，你就彻底失去了头游的机会。

## 应用条件
- ✅ **主攻角色**：不是主攻忌使用，新手最常犯这种错误。
- ✅ **单牌弱路****：** 如果单牌是强路且有两个小单张时，可酌情考虑。
- ✅ **两个小单张**：必然一大一小，先打哪个好呢？需要运用尾牌原理。

## 操作步骤
1. 判断牌力：确认自己牌力≥12点，适合当主攻
2. 识别弱路：确认单张是弱路
3. 检查赘牌：确认有超过2张10以下的单张赘牌
4. 首攻单张：优先处理弱路单张

## 技巧要点
- **首攻处理弱路**：是主攻后发制人的手法
- **盘牌首攻非常重要**：有时候首攻错了，头游也就飞了
- **两个小单张不打不健康**：这是掼蛋的经典口诀

## 实战示例
**牌型示例**：12点以上强牌，单张弱路，有2张以上10以下的单张赘牌

**操作过程**：
1. 起手判断牌力：12点以上，适合主攻
2. 识别弱路：单张是弱路
3. 首攻单张：优先处理小单张

**效果分析**：通过首攻处理弱路，避免后期无法冲刺，为头游创造条件

## 常见错误
- ❌ **新手错误**：不是主攻也使用此技巧
- ❌ **判断错误**：单牌是强路时也盲目首攻单张
- ❌ **时机错误**：中后期还使用开局策略

## 前置知识
- [牌力评估方法]
- [主攻与助攻的职责]

## 后续知识
- [尾牌原理---富有张力的打牌技巧]
- [初期想顺牌，不打上家牌]

## 相关技巧
- [尾牌原理]
- [初期策略]
```

#### 格式化示例：残局技巧

**原内容**（掼蛋技巧秘籍(丁华).md 第1152-1233行）：
```markdown
### 第23篇  残局逼炸为先

残局阶段，随着手数的减少，自己的牌己具备冲刺的条件。这
时如果发现下家也接近听牌，则要注意控制出牌次序，谨防下家趁
机顺牌，特别是你手里的炸弹不算很大的情况下。
...
```

**格式化后**（`docs/knowledge/skills/08_endgame/02_endgame_bomb_techniques.md`）：
```markdown
---
title: 残局逼炸为先
type: skill
category: Skills/Endgame
source: 掼蛋技巧秘籍(丁华).md
tags: [残局, 主攻, 逼炸, 冲刺]
difficulty: 高级
priority: 5
game_phase: endgame
part: 第23篇
---

# 残局逼炸为先

## 概述
残局阶段，随着手数的减少，自己的牌已具备冲刺的条件。这时如果发现下家也接近听牌，则要注意控制出牌次序，谨防下家趁机顺牌，特别是你手里的炸弹不算很大的情况下。

## 适用阶段
- **开局阶段**：❌ 不适用
- **中局阶段**：⚠️ 部分适用，但效果不如残局明显
- **残局阶段**：✅ 主要适用于残局阶段的冲刺控制

## 核心原理
在发起冲刺时疏于控制，被对手抢先一步的例子有很多。残局阶段需要特别注意出牌次序，防止下家顺牌。

## 应用条件
- ✅ **残局阶段**：手数减少，已具备冲刺条件
- ✅ **下家接近听牌**：需要特别注意控制
- ✅ **炸弹不算很大**：更需要谨慎控制出牌次序

## 操作步骤
1. **大王逼炸**：下家接近听牌，自己对子小且无法回收时，先出大王 (`R`) 逼炸
2. **登基牌逼炸**：对2 (`Pair` of `main_rank`) 已登基，先出对2逼炸
3. **小炸空掷**：2把小炸+1个小对，预感下家接近听牌，先空掷1把小炸
4. **拆炸弹逼炸**：下家8张接近听牌，拆同花炸出杂顺逼炸
5. **大炸先出防顶嘴**：1大1小两炸，下家接近听牌，先出小炸逼炸

## 技巧要点
- **逼炸为先**：残局阶段控制出牌次序的关键
- **防止下家顺牌**：特别是炸弹不够大的情况下
- **逢7逢8出组牌**：下家余7-8张时，出组牌逼炸

## 实战示例
**牌型示例**：残局阶段，手数减少，下家接近听牌

**操作过程**：
1. 判断局势：确认下家接近听牌
2. 选择逼炸方式：根据手牌情况选择大王逼炸、登基牌逼炸等
3. 控制出牌次序：先出逼炸牌，防止下家顺牌

**效果分析**：通过逼炸控制，防止下家抢先一步，为自己冲刺创造条件

## 常见错误
- ❌ **疏于控制**：发起冲刺时没有注意控制出牌次序
- ❌ **判断错误**：下家牌还有很多时也过度谨慎
- ❌ **时机错误**：炸弹够大时也过度小心

## 前置知识
- [尾牌原理在残局中的应用]
- [出炸技巧]
- [听牌与送听]

## 后续知识
- [残局攻防(一)]
- [残局攻防(二)]
- [残局攻防(三)]

## 相关技巧
- [尾牌原理]
- [出炸技巧]
- [听牌技巧]
```

---

## 🔗 知识关联映射

### 与架构方案的对应关系

**知识库格式化方案与架构方案的知识库模块对应关系**：

| 格式化方案分类 | 架构方案模块 | 架构方案层级 | 实现方式 | 访问接口 |
|--------------|------------|------------|---------|---------|
| 规则知识 (Rules) | 规则库 (Rules Library) | 硬编码层 | 硬编码到GameRules类 | GameRules类方法 |
| 策略知识 (Strategy) | 策略库 (Strategy Library) | 内存加载层 | 启动时加载到内存 | StrategyLibrary类方法 |
| 技巧知识 (Skills) | 技巧库 (Skills Library) | 按需查询层 | 按需查询知识库文件 | SkillsLibrary.query_skill() |
| 心理知识 (Psychology) | 技巧库 (Skills Library) | 按需查询层 | 按需查询知识库文件（位于skills/05_psychology/） | SkillsLibrary.query_skill() |

**知识检索器对应关系**：
- 所有按需查询层的知识（技巧知识、心理知识）通过架构方案的`KnowledgeRetriever`类进行查询
- `KnowledgeRetriever`提供以下查询方法（对应架构方案3.4.5节）：
  - `search(query, filters)`: 语义搜索
  - `query_by_tags(tags)`: 按标签查询
  - `query_by_phase(phase)`: 按游戏阶段查询（opening/midgame/endgame）
  - `get_related_knowledge(knowledge_id)`: 关联查询

### 关联关系表

| 规则知识 | 基础知识 | 策略知识 | 技巧知识 |
|---------|---------|---------|---------|
| 牌型定义 | 牌型指南 | 配牌策略 | 配炸技巧 |
| 出牌规则 | 出牌流程 | 出牌策略 | 出炸技巧 |
| 升级规则 | 升级流程 | 升级策略 | 留风技巧 |
| 进贡规则 | 进贡流程 | 进贡策略 | 进贡还贡技巧 |
| - | - | - | 开局技巧 ⭐ 新增 |
| - | - | - | 残局技巧 ⭐ 新增 |

---

## 📊 知识优先级体系

### 优先级定义

- **P5（最高）**：核心规则、基础概念、常用技巧
- **P4（高）**：重要策略、常用技巧
- **P3（中）**：进阶策略、高级技巧
- **P2（低）**：特殊场景、边缘技巧
- **P1（最低）**：参考知识、补充说明

### 难度等级定义

- **入门**：新手必须掌握
- **初级**：有一定基础后学习
- **中级**：需要实战经验
- **高级**：需要深入理解
- **专家**：专业级技巧

---

## 🛠️ 实施步骤

### 第一阶段：规则知识格式化（优先级最高）

1. **提取核心规则**
   - 从《江苏掼蛋规则.md》提取所有规则点
   - 按规则类型分类
   - 标注规则优先级

2. **结构化规则内容**
   - 使用规则类模板格式化
   - 建立规则关联关系
   - 补充规则应用场景

### 第二阶段：基础知识格式化

1. **整合入门指南**
   - 将《掼蛋入门指南.txt》内容格式化
   - 补充规则细节
   - 简化复杂概念

2. **建立知识关联**
   - 链接到规则知识
   - 标注前置和后续知识

### 第三阶段：技巧知识格式化（工作量最大）

1. **提取技巧文章**
   - 从《掼蛋技巧秘籍(丁华).md》提取71篇技巧
   - 按主题分类（基础/主攻/助攻/通用/心理/高级）

2. **格式化技巧内容**
   - 使用技巧类模板
   - 提取核心要点
   - 标注技巧难度和优先级

3. **建立技巧关联**
   - 建立技巧之间的前后关系
   - 标注相关技巧
   - 建立技巧与规则的关联

### 第四阶段：知识库整合

1. **统一格式检查**
   - 检查所有文档格式一致性
   - 验证元数据完整性
   - 检查链接有效性

2. **建立知识索引**
   - 按分类建立索引
   - 按标签建立索引
   - 按难度建立索引

3. **生成知识图谱**
   - 可视化知识关联关系
   - 标注知识层级

---

## 📝 格式化检查清单

### 文档级别检查

- [ ] 元数据完整（title, type, category, tags, difficulty, priority）
- [ ] 标题层级清晰（H1-H3）
- [ ] 内容结构完整（概述、详细内容、应用场景、示例、注意事项）
- [ ] 知识关联标注（前置、后续、相关、对立）

### 内容级别检查

- [ ] 术语使用一致
- [ ] 示例准确清晰
- [ ] 注意事项明确
- [ ] 难度标注合理

### 关联级别检查

- [ ] 前置知识链接有效
- [ ] 后续知识链接有效
- [ ] 相关知识链接有效
- [ ] 知识层级关系正确

---

## 🎯 预期效果

### 对AI系统的价值

1. **结构化知识表示**
   - 统一的格式便于AI理解
   - 清晰的层级便于检索
   - 明确的关联便于推理

2. **知识检索效率**
   - 按分类快速定位
   - 按标签精确检索
   - 按难度分层学习

3. **知识应用准确性**
   - 明确的应用场景
   - 清晰的执行步骤
   - 详细的注意事项

### 对开发者的价值

1. **知识维护便利**
   - 模块化结构便于更新
   - 清晰的关联便于扩展
   - 统一的格式便于管理

2. **知识扩展容易**
   - 模板化便于添加新知识
   - 关联机制便于整合
   - 索引机制便于查找

---

## 📌 注意事项

1. **保持原意**
   - 格式化过程中不能改变原意
   - 补充说明要标注来源
   - 简化表达要保留核心

2. **统一术语和变量命名**
   - **使用官方术语**：江苏掼蛋规则中的官方术语
   - **使用平台变量名**：所有牌型、花色、点数必须使用南京邮电大学平台标准变量名（基于v1006使用说明书）
     - 牌型：`Single`, `Pair`, `Trips`, `ThreePair`, `ThreeWithTwo`, `TwoTrips`, `Straight`, `StraightFlush`, `Bomb`, `tribute`, `back`, `PASS` ⭐ 更新
     - 花色：`S`(黑桃), `H`(红桃), `D`(方片), `C`(梅花) ⭐ 更新：红桃/方片
     - 点数：`A`, `2-9`, `T`(10), `J`, `Q`, `K`, `B`(小王), `R`(大王)
     - 游戏状态：`handCards`(手牌), `myPos`(我的座位), `curPos`(当前玩家), `stage`(阶段), `type`(消息类型) ⭐ 更新
   - **建立术语映射表**：中文术语 → 平台变量名
   - **标注术语解释**：首次出现时标注平台变量名（如：单张 (Single)）

3. **变量命名检查**
   - [ ] 所有牌型引用使用平台变量名
   - [ ] 所有花色引用使用平台变量名
   - [ ] 所有点数引用使用平台变量名
   - [ ] 代码示例中的变量名符合平台标准
   - [ ] JSON示例格式符合平台要求

4. **持续更新**
   - 规则更新要及时同步
   - 新技巧要及时添加
   - 关联关系要及时调整
   - 平台变量名变更要及时更新

---

**文档版本**: v3.1  
**创建时间**: 使用系统时间API获取（`datetime.now()`）  
**最后更新**: 使用系统时间API获取（`datetime.now()`）- 对齐架构方案  
**维护责任**: 知识库管理团队

## 📝 更新日志

### v3.1 (2025-01-27)
- ✅ 对齐《掼蛋AI客户端架构方案.md》的知识库模块设计
- ✅ 明确知识分类与架构方案分层记忆策略的对应关系
  - 规则知识/基础知识 → 规则库（硬编码层）
  - 策略知识 → 策略库（内存加载层）
  - 技巧知识/心理知识 → 技巧库（按需查询层）
- ✅ 更新目录结构说明，明确与架构方案的对应关系
- ✅ 添加知识库格式化方案与架构方案的对应关系表
- ✅ 明确知识检索器（KnowledgeRetriever）的查询方式
- ✅ 修正同花顺变量名为`StraightFlush`（平台标准）
- ✅ 更新文档概述，说明与架构方案的对齐关系

### v3.0 (使用系统时间API获取)
- ✅ 增加开局技巧类目（Skills/Opening）
- ✅ 增加残局技巧类目（Skills/Endgame）
- ✅ 在格式化结构中新增 `07_opening/` 和 `08_endgame/` 目录
- ✅ 在元数据标准中增加 `game_phase` 字段（opening/midgame/endgame）
- ✅ 在技巧类模板中增加"适用阶段"说明
- ✅ 提供开局和残局知识点的格式化示例
- ✅ 更新知识关联映射表，增加开局和残局技巧
- ✅ 重新组织技巧知识格式化结构，将开局和残局相关内容归类

### v2.0 (使用系统时间API获取)
- ✅ 添加变量命名统一标准（基于南京邮电大学平台）
- ✅ 统一牌型变量命名（Single/Pair/Trips/ThreePair/ThreeWithTwo/TwoTrips/Straight/Bomb）
- ✅ 统一花色变量命名（S/H/D/C/R/B）
- ✅ 统一点数变量命名（A/2-9/T/J/Q/K）
- ✅ 统一游戏状态变量命名（seat/teammate_seat/main_rank等）
- ✅ 添加变量命名使用规范和检查清单
- ✅ 更新格式化示例，确保使用平台标准变量名
- ✅ 统一时间落款规范：所有时间字段必须使用系统时间API

### v1.0 (使用系统时间API获取)
- 初始版本，提出知识库格式化方案

---

## ⏰ 时间处理规范

### 时间字段要求

**所有时间相关字段必须使用系统时间API，禁止硬编码时间。**

#### Python示例
```python
from datetime import datetime

# 获取当前时间
current_time = datetime.now()

# 格式化时间字符串
time_str = current_time.strftime('%Y-%m-%d %H:%M:%S')
# 输出：2025-01-XX XX:XX:XX

# 中文格式
time_str_cn = current_time.strftime('%Y年%m月%d日 %H:%M:%S')
# 输出：2025年01月XX日 XX:XX:XX
```

#### JavaScript示例
```javascript
// 获取当前时间
const currentTime = new Date();

// 格式化时间字符串
const timeStr = currentTime.toLocaleString('zh-CN', {
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit'
});
// 输出：2025/01/XX XX:XX:XX

// ISO格式
const isoStr = currentTime.toISOString();
// 输出：2025-01-XXTXX:XX:XX.XXXZ
```

### 元数据时间字段

在格式化知识库文档时，`last_updated` 字段必须使用系统时间API：

```markdown
---
title: 知识点标题
last_updated: {{ datetime.now().strftime('%Y-%m-%d %H:%M:%S') }}
---
```

**禁止写法**：
```markdown
---
last_updated: 2025年1月  # ❌ 硬编码时间
last_updated: 2025-01-15  # ❌ 硬编码时间
---
```

**正确写法**：
```markdown
---
last_updated: {{ datetime.now().strftime('%Y-%m-%d %H:%M:%S') }}  # ✅ 使用系统时间
---
```

### 文档版本信息

文档底部的版本信息也应使用系统时间：

```markdown
**文档版本**: v2.0  
**创建时间**: {{ datetime.now().strftime('%Y年%m月%d日') }}  
**最后更新**: {{ datetime.now().strftime('%Y年%m月%d日') }}  
```

### 更新日志

更新日志中的时间也应使用系统时间API：

```markdown
### v2.0 ({{ datetime.now().strftime('%Y年%m月') }})
- 更新内容...
```

