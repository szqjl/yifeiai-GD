# V4混合决策引擎 - 团队协作指南

## 📋 项目概述

我们正在开发**Hybrid Decision Engine V4**，这是一个lalala优先 + DecisionEngine后备的混合决策系统。

### 项目目标
- 🎯 保持lalala的40-50%胜率
- 🎯 4层决策保护机制（永不崩溃）
- 🎯 修复V3的数据转换问题

### 当前进度
- ✅ 已完成：4/23任务 (17.4%)
- 🔄 进行中：阶段2 - 决策层实现
- ⏳ 待完成：19个任务

---

## 🚀 快速开始（新成员）

### 步骤1：克隆项目

选择一个仓库克隆（两个仓库内容相同）：

**选项A：从Gitee克隆（推荐，国内速度快）**
```bash
git clone https://gitee.com/philsz/yifei-ai-gd.git
cd yifei-ai-gd
```

**选项B：从GitHub克隆**
```bash
git clone https://github.com/szqjl/yifeiAI-gd.git
cd yifeiAI-gd
```

### 步骤2：安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 步骤3：验证环境

```bash
# 运行已完成任务的验证脚本
python verify_task1.py   # 验证任务1
python verify_task3.py   # 验证任务3
python verify_task4_simple.py  # 验证任务4
```

如果所有验证都通过，说明环境配置正确！

### 步骤4：了解项目结构

```
YiFeiAI-GD/
├── .kiro/specs/hybrid-decision-v4/  # 规格文档
│   ├── requirements.md              # 需求文档
│   ├── design.md                    # 设计文档
│   └── tasks.md                     # 任务清单
├── src/
│   ├── decision/
│   │   └── hybrid_decision_engine_v4.py  # 核心决策引擎
│   └── communication/
│       └── lalala_adapter_v4.py          # 数据转换适配器
├── V4_实施TODO.md                   # 总体进度和任务分配
└── 团队协作指南.md                  # 本文档
```

---

## 👥 协作流程

### 角色分工

1. **项目经理（Kiro）**
   - 审查所有代码
   - 运行测试验证
   - 提交到Git
   - 更新进度文档
   - 协调任务分配

2. **开发者（团队成员/AI）**
   - 实施分配的任务
   - 编写代码
   - 创建验证脚本
   - 完成后通知项目经理

### 工作流程

```
1. 查看待办任务
   ↓
2. 选择/被分配任务
   ↓
3. 拉取最新代码
   ↓
4. 实施任务
   ↓
5. 创建验证脚本
   ↓
6. 通知项目经理
   ↓
7. 项目经理审查
   ↓
8. 项目经理提交
   ↓
9. 继续下一个任务
```

---

## 📝 如何领取任务

### 方法1：查看TODO文档

打开 `V4_实施TODO.md`，查看：
- 当前进度
- 待开始的任务
- 任务优先级
- 任务依赖关系

### 方法2：查看任务清单

打开 `.kiro/specs/hybrid-decision-v4/tasks.md`，查看详细的任务描述。

### 当前可领取的任务

**阶段2：决策层实现**（当前阶段）

- [ ] **任务5**: 实现Layer 2 (DecisionEngine)
  - 优先级：🔴 高
  - 依赖：任务1
  - 预计时间：1-2小时

- [ ] **任务6**: 实现Layer 3 (KnowledgeEnhanced)
  - 优先级：🔴 高
  - 依赖：任务1
  - 预计时间：1-2小时

- [ ] **任务7**: Layer 4 (Random)
  - 状态：✅ 已在任务1中完成

---

## 💻 实施任务的步骤

### 1. 拉取最新代码

```bash
# 确保在main分支
git checkout main

# 拉取最新代码
git pull origin main
```

### 2. 阅读任务文档

- 打开 `V4_实施TODO.md` 查看任务详情
- 阅读 `.kiro/specs/hybrid-decision-v4/design.md` 了解设计
- 查看已完成的类似任务作为参考

### 3. 实施任务

按照任务要求编写代码，参考：
- 设计文档中的接口定义
- 已完成任务的代码风格
- 验收标准

### 4. 创建验证脚本

创建 `verify_taskX.py` 脚本测试你的实现：

```python
# verify_task5.py 示例
print("=" * 60)
print("任务5验证：Layer 2 (DecisionEngine)决策逻辑")
print("=" * 60)

# 测试1: 初始化
# 测试2: 调用DecisionEngine
# 测试3: 错误处理
# ...

print("\n✓ 任务5验证通过！")
```

### 5. 运行验证

```bash
python verify_taskX.py
```

确保所有测试通过！

### 6. 通知项目经理

告诉项目经理（Kiro）：
```
"任务X已完成，验证脚本：verify_taskX.py，所有测试通过 ✅"
```

---

## 🔧 开发规范

### 代码风格

1. **命名规范**
   - 类名：PascalCase（如 `HybridDecisionEngineV4`）
   - 函数名：snake_case（如 `_try_lalala`）
   - 常量：UPPER_CASE（如 `MAX_RETRIES`）

2. **注释规范**
   ```python
   def decide(self, message: dict) -> int:
       """
       Make a decision using 4-layer fallback mechanism.
       
       Args:
           message: Game state message from server
           
       Returns:
           Action index (0 for PASS, 1+ for play actions)
       """
   ```

3. **日志规范**
   ```python
   self.logger.info("正常信息")
   self.logger.warning("警告信息")
   self.logger.error("错误信息", exc_info=True)
   ```

### Git提交规范

**不需要你提交！** 项目经理会统一提交。

但了解提交格式有助于理解项目历史：

```
✨ feat 任务X: 简短描述

详细说明：
- 实现了什么功能
- 修复了什么问题
- 验收标准

完成任务: 任务X
验收标准: ✅ 列表
测试: verify_taskX.py 通过
```

---

## 📚 重要文档

### 必读文档

1. **V4_实施TODO.md** - 总体进度和任务分配
2. **.kiro/specs/hybrid-decision-v4/requirements.md** - 需求文档
3. **.kiro/specs/hybrid-decision-v4/design.md** - 设计文档
4. **.kiro/specs/hybrid-decision-v4/tasks.md** - 任务清单

### 参考文档

1. **超越lalala策略路线图.md** - 项目背景和目标
2. **实施完成总结.md** - 之前的经验教训
3. **verify_task*.py** - 已完成任务的验证脚本

---

## 🤝 沟通协作

### 沟通渠道

- **任务分配**：通过项目经理（Kiro）
- **进度汇报**：完成任务后通知项目经理
- **问题讨论**：遇到问题及时沟通

### 汇报模板

```
任务X完成汇报：

✅ 实现内容：
- 功能1
- 功能2
- 功能3

✅ 验证结果：
- verify_taskX.py 全部通过
- 所有验收标准满足

📁 修改的文件：
- src/xxx/xxx.py

⏰ 耗时：X小时

💡 备注：
- 遇到的问题和解决方案
- 需要注意的地方
```

---

## ⚠️ 注意事项

### 重要规则

1. **不要直接提交代码**
   - 所有代码由项目经理审查后统一提交
   - 这样可以保证代码质量和Git历史清晰

2. **不要修改其他任务的代码**
   - 只修改你负责任务相关的文件
   - 避免冲突和混乱

3. **不要跳过验证**
   - 必须创建验证脚本
   - 必须确保所有测试通过

4. **及时同步代码**
   - 开始任务前先 `git pull`
   - 避免基于旧代码开发

### 常见问题

**Q: 我应该从哪个任务开始？**
A: 查看 `V4_实施TODO.md` 中标记为"待开始"且优先级高的任务，或询问项目经理。

**Q: 任务之间有依赖怎么办？**
A: 任务清单中标注了依赖关系，确保依赖的任务已完成再开始。

**Q: 遇到技术问题怎么办？**
A: 先查看设计文档和已完成的类似任务，如果还是不清楚，询问项目经理。

**Q: 验证脚本应该测试什么？**
A: 参考任务的验收标准，确保每个验收标准都有对应的测试。

**Q: 可以同时做多个任务吗？**
A: 不建议。专注完成一个任务，确保质量，然后再开始下一个。

---

## 🎯 当前任务状态

### 已完成 ✅
- [x] 任务1: HybridDecisionEngineV4核心类
- [x] 任务2: DecisionStatistics监控类
- [x] 任务3: LalalaAdapter数据转换增强
- [x] 任务4: Layer 1 (lalala)决策逻辑

### 进行中 🔄
- [ ] 无

### 待领取 ⏳
- [ ] 任务5: Layer 2 (DecisionEngine)
- [ ] 任务6: Layer 3 (KnowledgeEnhanced)
- [ ] 任务8: 异常处理和后备链
- [ ] 任务9: 状态管理
- [ ] ...更多任务见 `V4_实施TODO.md`

---

## 📞 联系方式

**项目经理**: Kiro (AI助手)
**项目仓库**: 
- Gitee: https://gitee.com/philsz/yifei-ai-gd.git
- GitHub: https://github.com/szqjl/yifeiAI-gd.git

---

## 🚀 开始贡献

1. 克隆项目
2. 阅读文档
3. 选择任务
4. 开始编码
5. 创建验证
6. 通知审查

欢迎加入V4开发团队！让我们一起打造一个稳定、高效的混合决策引擎！🎉

---

**最后更新**: 2024-11-29  
**文档版本**: 1.0  
**项目状态**: 进行中 (17.4%完成)
